# 数据分析记录（2025.08账期）

## 1. 原始社保明细文件概览

根目录下 9 份“未申报信息明细表”均来自社保局导出，结构完全一致：  
`序号 / 姓名 / 证件类型 / 证件号码 / 缴费工资 / 缴费基数 / 费率 / 应缴费额 / 减免费额 / 应补(退)费额 / 人员编号`。  
数值字段存在千分位分隔符，需要在解析时去除。所有文件均包含 79 条记录，`减免费额` 全部为 0。

| 文件名 | 险种 | 缴费部分 | 费率 | 缴费基数合计 | 应缴费额合计 |
| --- | --- | --- | --- | --- | --- |
| 职工基本养老保险(个人缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 养老保险 | 个人 | 8% | 344,361.00 | 27,548.88 |
| 职工基本养老保险(单位缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 养老保险 | 单位 | 16% | 344,361.00 | 55,097.76 |
| 职工基本医疗保险(个人缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 医疗保险 | 个人 | 2% | 344,361.00 | 6,887.22 |
| 职工基本医疗保险(单位缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 医疗保险 | 单位 | 8.5% | 344,361.00 | 29,271.08 |
| 职工大额医疗互助保险(个人缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 大额医疗 | 个人 | 定额 5 元 | 395.00 | 395.00 |
| 职工大额医疗互助保险(单位缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 大额医疗 | 单位 | 1.5% | 344,361.00 | 5,165.81 |
| 失业保险(个人缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 失业保险 | 个人 | 0.5% | 344,361.00 | 1,722.20 |
| 失业保险(单位缴纳)\_2025-08至2025-08\_未申报信息明细表.xlsx | 失业保险 | 单位 | 0.5% | 344,361.00 | 1,722.20 |
| 工伤保险\_2025-08至2025-08\_未申报信息明细表.xlsx | 工伤保险 | 单位 | 1.65% | 344,361.00 | 5,681.68 |

> 备注  
> - `缴费工资` 合计统一为 184,070.00（79 人 × 2,330 元），除“大额医疗个人”外与 `缴费基数` 一致。  
> - `人员编号` 在部分险种为数值型，在医疗、失业等险种为字符串编码。  
> - 所有险种的人员名单与排序一致，可按 `证件号码` 作为交集键。

## 2. 目标文件《2025.08社保总表.xlsx》

工作簿包含 9 个工作表，对应上述险种与单位/个人划分，字段与原始文件一致。  
逐表比对后确认：

| Sheet 名称 | 对应原始文件 | 行数 | 应缴费额合计 | 备注 |
| --- | --- | --- | --- | --- |
| 养老（个人） | 职工基本养老保险(个人缴纳) | 79 | 27,548.88 | 与原始数据一一对应 |
| 基本医疗（个人） | 职工基本医疗保险(个人缴纳) | 79 | 6,887.22 | |
| 大额医疗（个人） | 职工大额医疗互助保险(个人缴纳) | 79 | 395.00 | `缴费基数` 为 5 元定额 |
| 失业（个人） | 失业保险(个人缴纳) | 79 | 1,722.20 | |
| 养老（单位） | 职工基本养老保险(单位缴纳) | 79 | 55,097.76 | 数值与原始表完全一致 |
| 基本医疗（单位） | 职工基本医疗保险(单位缴纳) | 79 | 29,271.08 | |
| 大额医疗（单位） | 职工大额医疗互助保险(单位缴纳) | 79 | 5,165.81 | |
| 失业（单位） | 失业保险(单位缴纳) | 79 | 1,722.20 | |
| 工伤 | 工伤保险 | 79 | 5,681.68 | |

该文件可视为“原始记录表”的清洗结果：  
1. 保留相同列结构；  
2. 去除千分位分隔符与字符串数值；  
3. 暂未发现空记录与异常金额。

## 3. 目标文件《2025.08社保扣款明细.xlsx》

工作簿含 24 个工作表（2024.1~2025.08 及汇总），当前账期为 `2025.08`。该表包含两段纵向排布的明细：

### 3.1 个人部分

- 标题行：“2025年8月社保扣款明细（个人）”。
- 表头三行：字段名、中文说明、费率提示。
- 字段：`序号 / 姓名 / 部门 / 基数 / 养老保险(0.080) / 医疗+生育保险(0.020) / 大额医疗(定额5.00元) / 失业保险(0.005) / 小计`。
- 明细 79 行，每行小计 = 养老 + 医疗生育 + 大额 + 失业。
- 合计行：`基数 344,361.00`，`养老 27,548.88`，`医疗+生育 6,887.22`，`大额 395.00`，`失业 1,722.20`，`小计 36,553.30`。

字段来源对应关系：

| 明细字段 | 来源险种 | 取值说明 |
| --- | --- | --- |
| 基数 | 任一险种的 `缴费基数`（均为 4,359 元），以养老(个人)为准 | |
| 养老保险 | 养老（个人）`应缴费额` | |
| 医疗+生育保险 | 基本医疗（个人）`应缴费额` | |
| 大额医疗 | 大额医疗（个人）`应缴费额`（固定 5 元） | |
| 失业保险 | 失业（个人）`应缴费额` | |
| 小计 | 上述四列求和 | |

### 3.2 单位部分

- 标题行：“2025年8月社保扣款明细（单位）”。
- 表头包含费率提示：养老 0.16、医疗+生育 0.10、工伤 0.011（原表显示 0.011，实际按 0.0165 计算）、失业 0.005。
- 字段：`序号 / 姓名 / 部门 / 基数 / 养老保险 / 医疗+生育保险 / 工伤保险 / 失业保险 / 小计`。
- 明细 79 行，小计 = 养老 + 医疗+生育 + 工伤 + 失业。
- 合计：`基数 344,361.00`，`养老 55,097.76`，`医疗+生育 34,436.89`，`工伤 5,681.68`，`失业 1,722.20`，`小计 96,938.53`。

字段来源与逻辑：

| 明细字段 | 来源险种 | 取值说明 |
| --- | --- | --- |
| 基数 | 养老（单位）`缴费基数`（每人 4,359 元） | |
| 养老保险 | 养老（单位）`应缴费额` | |
| 医疗+生育保险 | 基本医疗（单位）`应缴费额` + 大额医疗（单位）`应缴费额`（即 8.5% + 1.5% = 10%） | |
| 工伤保险 | 工伤保险 `应缴费额`（1.65%） | |
| 失业保险 | 失业（单位）`应缴费额`（0.5%） | |
| 小计 | 上述四列求和 | |

> 注意：原表头的工伤费率文字显示为 0.011，但金额以 1.65% 计算，应以数值为准。

## 4. 字段映射与处理规则总结

1. **唯一标识字段**：`证件号码` 与 `人员编号` 跨险种保持一致，可用于多表关联；推荐优先使用 `证件号码`（字符串，更稳定）。  
2. **金额列统一处理**：移除逗号、转浮点；保留两位小数，使用“四舍五入”。  
3. **费率换算**：  
   - 养老：个人 0.08；单位 0.16。  
   - 医疗：个人 0.02；单位 0.085。  
   - 大额医疗：个人定额 5 元；单位 0.015。  
   - 失业：个人/单位 0.005。  
   - 工伤：单位 0.0165。  
4. **社保总表生成**：按险种 × 缴费部分拆分，明细与原始完全一致，可视为规范化后的原始记录表。  
5. **社保扣款明细生成**：  
   - 个人段：从 4 个个人险种提取金额，保持原顺序；`部门` 字段需来自外部基础数据或上传时附带。  
   - 单位段：将单位医疗与大额医疗合并为 “医疗+生育”；其余险种直接引用。  
   - 需自动生成合计行与费率提示行（可通过模板或程序写入）。

## 5. 数据质量观察

- 79 名员工在所有险种中完全一致，未发现缺行或顺序错位。  
- `应补(退)费额` 与 `应缴费额` 相等，说明本期无补退。  
- `缴费工资`、`缴费基数` 两列皆为字符串格式，必须在导入时转数值。  
- 医疗单位与大额单位在最终明细中被合并，需要在系统中显式记录映射关系，避免重复统计。  
- 文件名中包含险种、缴费部分、账期，适合解析账期与险种类型。

## 6. 建议的数据模型细化

- `periods`：`id`，`year_month`，`created_at`，`status`。  
- `source_files`：`id`，`period_id`，`scheme`（养老/医疗/大额/失业/工伤），`part`（个人/单位），`path`，`original_name`，`uploaded_at`，`parsed_rows`。  
- `raw_records`：`id`，`period_id`，`scheme`，`part`，`seq`，`name`，`id_type`，`id_number`，`base_salary`，`base_amount`，`rate`，`amount_due`，`deduction`，`amount_adjust`，`person_code`，`source_file_id`。  
- `summary_totals`：`period_id`，`scheme`，`part`，`base_sum`，`amount_sum`，`headcount`。  
- `detail_charges`：`period_id`，`person_id`，`department`，`part`（个人/单位），`pension`，`medical`，`maternity`，`serious_illness`，`injury`，`unemployment`，`total`。  
- `reports`：`period_id`，`type`（raw/summary/detail/person/unit），`path`，`generated_at`。

## 7. 后续开发要点

1. 将上述映射规则固化为配置（险种 → 费率/合并逻辑），支持年度调整。  
2. 导入流程需校验 9 份原始文件齐全、行数与唯一键一致，否则提示缺失。  
3. 生成社保总表时保持原始顺序；导出时复现原版列名顺序。  
4. 生成扣款明细时分段写入个人/单位两张子表，可使用模板 + 填充的方式保留现有格式。  
5. 记录一份验证用的自动化脚本（如当前 `analyze_excels.py`）便于未来账期快速比对。  

> 本文数据来自 `excel_analysis.json` 与 `excel_summary.txt`（由 `analyze_excels.py` 自动生成），后续开发可复用脚本更新分析结果。

